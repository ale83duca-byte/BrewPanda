import React, { createContext, useState, useContext, useEffect, ReactNode, useCallback } from 'react';

// Inlined translations to bypass module resolution issues in the environment.
const it = {
    "header.activeYear": "ANNO ATTIVO",
    "header.dataSaved": "Dati Salvati",
    "sidebar.mainMenu": "MENU PRINCIPALE",
    "sidebar.home": "Home",
    "sidebar.movements": "Movimenti",
    "sidebar.warehouse": "Magazzino",
    "sidebar.loadGoods": "Carico Merce",
    "sidebar.dischargeGoods": "Scarico Merce Generico",
    "sidebar.exportYear": "Export Excel Anno",
    "sidebar.exportAllData": "Esporta Tutti i Dati",
    "sidebar.importData": "Importa Dati",
    "sidebar.refreshData": "Aggiorna Dati",
    "sidebar.productionManagement": "GESTIONE PRODUTTIVA",
    "sidebar.newBrew": "NUOVA COTTA",
    "sidebar.cellarManagement": "GESTIONE CANTINA",
    "sidebar.clientBeerDb": "DATABASE CLIENTI/BIRRE",
    "sidebar.yearArchive": "ARCHIVIO ANNI",
    "sidebar.createNewYear": "CREA NUOVO ANNO",
    "rightSidebar.commercialAdminTitle": "AMMINISTRAZIONE COMMERCIALE",
    "rightSidebar.batchCostButton": "Costi Lotto Prodotto",
    "rightSidebar.productionTrendButton": "Andamento di Produzione",
    "rightSidebar.brewQuoteButton": "Preventivo per Birra da Produrre",
    "rightSidebar.priceDbSearchTitle": "RICERCA DATABASE PREZZI",
    "rightSidebar.priceDbSearchPlaceholder": "Cerca prodotto...",
    "rightSidebar.coefficientsButton": "Coefficienti di Calcolo Prezzi",
    "rightSidebar.packagedBeerTitle": "BIRRA CONFEZIONATA",
    "rightSidebar.beerWarehouseButton": "Magazzino Birra Finita",
    "rightSidebar.salesOrderButton": "Commissione d'Ordine",
    "rightSidebar.beerInventoryButton": "Inventario Birra (Inizio Mese)",
    "rightSidebar.salesTrendButton": "Andamento Vendite",
    "footer.searchMovement": "CERCA MOVIMENTO",
    "footer.openLotto": "APRI LOTTO",
    "footer.open": "APRI",
    "loading.migratingDb": "Migrazione database in corso...",
    "loading.initializingYear": "Inizializzazione anno...",
    "loading.loadingData": "Caricamento dati...",
    "toast.dbUpdated": "Database aggiornato con successo!",
    "toast.expiredLotsDischarged": "Lotti scaduti scaricati: {{summary}}",
    "toast.noDataForYear": "Nessun dato trovato per l'anno {{year}}",
    "toast.dataExported": "Dati esportati con successo!",
    "toast.exportError": "Si è verificato un errore durante l'esportazione dei dati.",
    "toast.dataImported": "Dati importati con successo! L'applicazione verrà ricaricata.",
    "toast.importError": "Errore durante l'importazione: {{message}}",
    "toast.lottoNotFound": "Lotto '{{lottoId}}' non trovato nell'anno corrente.",
    "toast.analysisStateSaved": "Stato dell'analisi salvato con successo!",
    "toast.analysisClosed": "Analisi costi chiusa e finalizzata.",
    "errors.fileNotReadable": "File non leggibile.",
    "errors.invalidBackupFile": "File di backup non valido o corrotto.",
    "errors.unknown": "Errore sconosciuto.",
    "confirmations.import": "Sei sicuro di voler importare i dati? Questa operazione sovrascriverà tutti i dati attuali e non è reversibile.",
    "home.prodDateColumn": "DATA PROD.",
    "home.clientColumn": "CLIENTE",
    "home.lottoColumn": "LOTTO",
    "home.mustCounterColumn": "Litri (Contamosto)",
    "home.gasColumn": "Gas (m³)",
    "home.typeColumn": "TIPOLOGIA",
    "home.litersProdColumn": "LITRI PROD.",
    "home.fermenterColumn": "FERMENTATORE",
    "home.pkgDateColumn": "DATA CONF.",
    "home.litersPkgColumn": "LITRI CONF.",
    "home.pkgModeColumn": "MODALITÀ CONF.",
    "home.inventoryReminderTitle": "Promemoria Inventario",
    "home.inventoryReminderText": "È il primo lunedì del mese! Ricordati di effettuare l'inventario del magazzino birra finita.",
    "home.expiringBeerAlertTitle": "Birra Finita in Scadenza (entro 3 mesi)",
    "brewPage.exportButton": "Genera Foglio Cotta Excel",
    "brewPage.mustCounter": "Valore Conta Mosto Elettronico",
    "brewPage.mustCounterPrevious": "Valore Precedente",
    "brewPage.mustCounterMeasured": "Valore Misurato",
    "brewPage.mustCounterResult": "Litri Prodotti (calcolati)",
    "brewPage.gasBrewCounters": "Contatore Gas - Cotta",
    "brewPage.gasPackagingCounters": "Contatore Gas - Confezionamento",
    "brewPage.counterPrevious": "Lettura Precedente",
    "brewPage.counterCurrent": "Lettura Attuale",
    "brewPage.gasUsed": "Gas Usato (m³)",
    "brewPage.totalGasUsed": "GAS TOTALE UTILIZZATO:",
    "brewPage.expirationDate": "Data di Scadenza",
    "loadGoods.price": "Prezzo",
    "loadGoods.priceTooltip": "Inserisci il prezzo al kg, al litro, o al pezzo in base alla tipologia di prodotto.",
    "loadGoods.priceRequiredError": "Il prezzo deve essere maggiore di zero.",
    "priceSearch.modalTitle": "Risultati Ricerca Prezzi",
    "priceSearch.product": "Prodotto",
    "priceSearch.brand": "Marca",
    "priceSearch.supplier": "Fornitore",
    "priceSearch.lastPrice": "Ultimo Prezzo",
    "priceSearch.loadDate": "Data Carico",
    "priceSearch.priceValidUntil": "Prezzo Valido Fino Al",
    "priceSearch.noResults": "Nessun prodotto trovato per '{{searchTerm}}'.",
    "lottoAction.modalTitle": "Azioni per Lotto {{lottoId}}",
    "lottoAction.openBrewPage": "Apri Foglio Cotta",
    "lottoAction.openCostAnalysis": "Apri Analisi Costi",
    "costAnalysis.selectLottoTitle": "Seleziona un Lotto per l'Analisi Costi",
    "costAnalysis.lotto": "Lotto",
    "costAnalysis.beerName": "Nome Birra",
    "costAnalysis.client": "Cliente",
    "costAnalysis.prodDate": "Data Prod.",
    "costAnalysis.noLottos": "Nessun lotto di produzione trovato per questo anno.",
    "costAnalysis.analysisTitle": "Analisi Costi Lotto",
    "costAnalysis.backToSelection": "Torna alla Selezione Lotto",
    "costAnalysis.rawMaterialsCost": "Costi Materie Prime",
    "costAnalysis.ingredient": "Ingrediente",
    "costAnalysis.quantityUsed": "Q.tà Usata",
    "costAnalysis.unitPrice": "Prezzo Unit.",
    "costAnalysis.totalCost": "Costo Totale",
    "costAnalysis.subtotal": "Subtotale",
    "costAnalysis.grandTotalRawMaterials": "Totale Costo Materie Prime",
    "costAnalysis.priceNotFound": "Prezzo non trovato",
    "costAnalysis.otherCosts": "Altri Costi",
    "costAnalysis.totalGasCost": "Costo Gas Totale",
    "costAnalysis.gasType": "Tipo Gas",
    "costAnalysis.additionalGases": "Gas Aggiuntivi",
    "costAnalysis.exciseDuty": "Accise",
    "costAnalysis.storage": "Stoccaggio",
    "costAnalysis.epal": "Epal",
    "costAnalysis.managementFees": "Spese Gestione Birrificio",
    "costAnalysis.grandTotal": "GRAN TOTALE COSTI LOTTO",
    "costAnalysis.effectivePricePerLiter": "PREZZO EFFETTIVO AL LITRO (SOLO BIRRA)",
    "costAnalysis.packagingCostAnalysis": "Analisi Costi Fusti",
    "costAnalysis.packagingFormat": "Formato",
    "costAnalysis.beerCostPerLiter": "Costo Birra / Litro",
    "costAnalysis.containerCostPerLiter": "Costo Contenitore / Litro",
    "costAnalysis.finalPricePerLiter": "Prezzo Finale / Litro",
    "costAnalysis.saveButton": "Salva Modifiche Analisi",
    "costAnalysis.closeButton": "Chiudi e Finalizza Analisi",
    "costAnalysis.exportButton": "Genera Foglio Excel",
    "costAnalysis.analysisClosedMessage": "Questa analisi è stata chiusa e non è più modificabile.",
    "costAnalysis.confirmCloseTitle": "Conferma Chiusura Analisi",
    "costAnalysis.confirmCloseMessage": "Sei sicuro di voler chiudere e finalizzare questa analisi? Non sarà più possibile apportare modifiche. L'azione è irreversibile.",
    "costAnalysis.cancel": "Annulla",
    "costAnalysis.confirm": "Sì, Chiudi",
    "costAnalysis.useLabels": "Includi costo etichetta?",
    "costAnalysis.bottleCostAnalysis": "Analisi Costi Imbottigliamento",
    "costAnalysis.bottleFormat": "Formato Bottiglia",
    "costAnalysis.bottleCount": "Q.tà Bottiglie",
    "costAnalysis.beerCostPerBottle": "Costo Birra / bott.",
    "costAnalysis.containerCostPerBottle": "Costo Bottiglia",
    "costAnalysis.capCostPerBottle": "Costo Tappo",
    "costAnalysis.cartonCostPerBottle": "Incid. Cartone",
    "costAnalysis.labelCostPerBottle": "Costo Etichetta",
    "costAnalysis.finalPricePerBottle": "Prezzo Finale / bott.",
    "costAnalysis.totalPriceForFormat": "Prezzo Totale Formato",
    "coefficients.modalTitle": "Coefficienti di Calcolo Prezzi",
    "coefficients.saveButton": "Salva Coefficienti",
    "coefficients.gplCost": "Costo GPL (€/m³)",
    "coefficients.gplCostTooltip": "Inserire il prezzo al metro cubo per il GPL, come da contratto di fornitura.",
    "coefficients.metanoCost": "Costo Metano (€/m³)",
    "coefficients.metanoCostTooltip": "Inserire il prezzo al metro cubo per il Metano, come da contratto di fornitura.",
    "coefficients.excise": "Coefficiente Accise",
    "coefficients.exciseTooltip": "Inserire il coefficiente per l'accisa sulla birra, comunicato annualmente dall'Agenzia delle Dogane.",
    "coefficients.storage": "Spese Stoccaggio Birra (€)",
    "coefficients.storageTooltip": "Inserire un costo forfettario per lo stoccaggio del lotto in celle frigorifere di proprietà.",
    "coefficients.epal": "Costo singolo Epal (€)",
    "coefficients.epalTooltip": "Inserire il costo di acquisto di un singolo bancale EPAL.",
    "coefficients.co2": "Costo CO2 una tantum (€)",
    "coefficients.co2Tooltip": "Inserire un costo forfettario per l'utilizzo di CO2 per il lotto.",
    "coefficients.azoto": "Costo Azoto una tantum (€)",
    "coefficients.azotoTooltip": "Inserire un costo forfettario per l'utilizzo di Azoto per il lotto.",
    "coefficients.management": "Spese Gestione (€/L)",
    "coefficients.managementTooltip": "Inserire un coefficiente (€/litro) per coprire le spese generali di gestione del birrificio e includere un margine di utile.",
    "coefficients.steelKegWashing": "Costo Lavaggio Fusto Acciaio (€)",
    "coefficients.steelKegWashingTooltip": "Inserire un costo forfettario per il lavaggio e la sanificazione di un fusto in acciaio riutilizzabile.",
    "coefficients.label": "Costo Etichetta Singola (€)",
    "coefficients.labelTooltip": "Inserire il costo di una singola etichetta autoadesiva.",
    "productionTrend.title": "Andamento di Produzione Cliente",
    "productionTrend.selectClientPrompt": "Seleziona un cliente per visualizzare l'analisi",
    "productionTrend.totalLitersProduced": "Litri Totali Prodotti",
    "productionTrend.productionHistory": "Storico Produzione",
    "productionTrend.packagedLiters": "Litri Confezionati",
    "productionTrend.formatsUsed": "Formati Utilizzati",
    "productionTrend.productionTimeline": "Andamento Temporale Produzione",
    "productionTrend.liters": "Litri",
    "productionTrend.analysisByBeer": "Analisi per Tipologia di Birra",
    "productionTrend.totalBatches": "Lotti totali",
    "productionTrend.preferredFormat": "Formato preferito",
    "productionTrend.analysisByFormat": "Analisi per Formato di Confezionamento",
    "productionTrend.volumeByBeerType": "Volume per Tipo Birra (%)",
    "productionTrend.volumeByFormat": "Volume per Formato (Litri)",
    "brewQuote.title": "Preventivo Birra da Produrre",
    "brewQuote.exportButton": "Genera Preventivo Excel",
    "brewQuote.headerTitle": "Informazioni Preventivo",
    "brewQuote.beerName": "Nome Birra (Teorico)",
    "brewQuote.estimatedLiters": "Litri Finali Stimati",
    "brewQuote.estimatedGas": "Consumo Gas Stimato (m³)",
    "brewQuote.ingredientsTitle": "Ingredienti Previsti",
    "brewQuote.addIngredient": "Aggiungi Ingrediente",
    "brewQuote.selectIngredient": "Seleziona Ingrediente...",
    "brewQuote.packagingTitle": "Piano di Confezionamento Previsto",
    "brewQuote.addPackaging": "Aggiungi Formato",
    "brewQuote.quantity": "Quantità",
    "brewQuote.pieces": "Pezzi",
    "brewQuote.saveButton": "Salva Preventivo",
    "brewQuote.quoteListTitle": "Elenco Preventivi",
    "brewQuote.newQuoteButton": "Crea Nuovo Preventivo",
    "brewQuote.quoteName": "Nome Preventivo",
    "brewQuote.date": "Data",
    "brewQuote.openButton": "Apri",
    "brewQuote.noQuotes": "Nessun preventivo salvato per questo anno.",
    "brewQuote.deleteConfirmTitle": "Conferma Eliminazione Preventivo",
    "brewQuote.deleteConfirmMessage": "Sei sicuro di voler eliminare questo preventivo? L'azione è irreversibile.",
    "toast.quoteSaved": "Preventivo salvato con successo!",
    "toast.quoteDeleted": "Preventivo eliminato.",
    "beerWarehouse.title": "Magazzino Birra Finita",
    "beerWarehouse.totalLiters": "Litri Totali",
    "beerWarehouse.batch": "Lotto",
    "beerWarehouse.format": "Formato",
    "beerWarehouse.quantity": "Quantità (pz)",
    "beerWarehouse.liters": "Litri",
    "beerWarehouse.noData": "Nessuna birra confezionata trovata per questo anno.",
    "beerWarehouse.expirationDate": "Scadenza",
    "salesTrend.topClientsByLiters": "Clienti Top (per Litri)",
    "salesTrend.topBeersByLiters": "Birre più vendute (per Litri)",
    "salesTrend.topFormatsByLiters": "Formati più venduti (per Litri)",
    "salesTrend.litersPurchased": "Litri acquistati",
    "salesTrend.litersSold": "Litri venduti",
    "salesTrend.monthlySalesTrend": "Andamento Mensile Vendite"
};

const en = {
    "header.activeYear": "ACTIVE YEAR",
    "header.dataSaved": "Data Saved",
    "sidebar.mainMenu": "MAIN MENU",
    "sidebar.home": "Home",
    "sidebar.movements": "Movements",
    "sidebar.warehouse": "Warehouse",
    "sidebar.loadGoods": "Load Goods",
    "sidebar.dischargeGoods": "General Discharge",
    "sidebar.exportYear": "Export Year (Excel)",
    "sidebar.exportAllData": "Export All Data",
    "sidebar.importData": "Import Data",
    "sidebar.refreshData": "Refresh Data",
    "sidebar.productionManagement": "PRODUCTION MANAGEMENT",
    "sidebar.newBrew": "NEW BREW",
    "sidebar.cellarManagement": "CELLAR MANAGEMENT",
    "sidebar.clientBeerDb": "CLIENT/BEER DATABASE",
    "sidebar.yearArchive": "YEAR ARCHIVE",
    "sidebar.createNewYear": "CREATE NEW YEAR",
    "rightSidebar.commercialAdminTitle": "COMMERCIAL ADMINISTRATION",
    "rightSidebar.batchCostButton": "Product Batch Costs",
    "rightSidebar.productionTrendButton": "Production Trend",
    "rightSidebar.brewQuoteButton": "Quote for Beer to Produce",
    "rightSidebar.priceDbSearchTitle": "PRICE DATABASE SEARCH",
    "rightSidebar.priceDbSearchPlaceholder": "Search product...",
    "rightSidebar.coefficientsButton": "Price Calculation Coefficients",
    "rightSidebar.packagedBeerTitle": "PACKAGED BEER",
    "rightSidebar.beerWarehouseButton": "Finished Beer Warehouse",
    "rightSidebar.salesOrderButton": "Sales Order",
    "rightSidebar.beerInventoryButton": "Beer Inventory (Month Start)",
    "rightSidebar.salesTrendButton": "Sales Trend",
    "footer.searchMovement": "SEARCH MOVEMENT",
    "footer.openLotto": "OPEN BATCH",
    "footer.open": "OPEN",
    "loading.migratingDb": "Migrating database...",
    "loading.initializingYear": "Initializing year...",
    "loading.loadingData": "Loading data...",
    "toast.dbUpdated": "Database updated successfully!",
    "toast.expiredLotsDischarged": "Expired lots discharged: {{summary}}",
    "toast.noDataForYear": "No data found for year {{year}}",
    "toast.dataExported": "Data exported successfully!",
    "toast.exportError": "An error occurred while exporting data.",
    "toast.dataImported": "Data imported successfully! The application will now reload.",
    "toast.importError": "Error during import: {{message}}",
    "toast.lottoNotFound": "Batch '{{lottoId}}' not found in the current year.",
    "toast.analysisStateSaved": "Analysis state saved successfully!",
    "toast.analysisClosed": "Cost analysis closed and finalized.",
    "errors.fileNotReadable": "File is not readable.",
    "errors.invalidBackupFile": "Invalid or corrupted backup file.",
    "errors.unknown": "Unknown error.",
    "confirmations.import": "Are you sure you want to import data? This will overwrite all current data and is not reversible.",
    "home.prodDateColumn": "PROD. DATE",
    "home.clientColumn": "CLIENT",
    "home.lottoColumn": "BATCH",
    "home.mustCounterColumn": "Liters (Counter)",
    "home.gasColumn": "Gas (m³)",
    "home.typeColumn": "TYPE",
    "home.litersProdColumn": "LITERS PROD.",
    "home.fermenterColumn": "FERMENTER",
    "home.pkgDateColumn": "PKG. DATE",
    "home.litersPkgColumn": "LITERS PKG.",
    "home.pkgModeColumn": "PKG. MODE",
    "home.inventoryReminderTitle": "Inventory Reminder",
    "home.inventoryReminderText": "It's the first Monday of the month! Remember to take inventory of the finished beer warehouse.",
    "home.expiringBeerAlertTitle": "Finished Beer Expiring (within 3 months)",
    "brewPage.exportButton": "Generate Brew Sheet Excel",
    "brewPage.mustCounter": "Electronic Must Counter Value",
    "brewPage.mustCounterPrevious": "Previous Value",
    "brewPage.mustCounterMeasured": "Measured Value",
    "brewPage.mustCounterResult": "Liters Produced (calculated)",
    "brewPage.gasBrewCounters": "Gas Counter - Brewing",
    "brewPage.gasPackagingCounters": "Gas Counter - Packaging",
    "brewPage.counterPrevious": "Previous Reading",
    "brewPage.counterCurrent": "Current Reading",
    "brewPage.gasUsed": "Gas Used (m³)",
    "brewPage.totalGasUsed": "TOTAL GAS USED:",
    "brewPage.expirationDate": "Expiration Date",
    "loadGoods.price": "Price",
    "loadGoods.priceTooltip": "Enter the price per kg, per liter, or per piece based on the product type.",
    "loadGoods.priceRequiredError": "Price must be greater than zero.",
    "priceSearch.modalTitle": "Price Search Results",
    "priceSearch.product": "Product",
    "priceSearch.brand": "Brand",
    "priceSearch.supplier": "Supplier",
    "priceSearch.lastPrice": "Last Price",
    "priceSearch.loadDate": "Load Date",
    "priceSearch.priceValidUntil": "Price Valid Until",
    "priceSearch.noResults": "No products found for '{{searchTerm}}'.",
    "lottoAction.modalTitle": "Actions for Batch {{lottoId}}",
    "lottoAction.openBrewPage": "Open Brew Sheet",
    "lottoAction.openCostAnalysis": "Open Cost Analysis",
    "costAnalysis.selectLottoTitle": "Select a Batch for Cost Analysis",
    "costAnalysis.lotto": "Batch",
    "costAnalysis.beerName": "Beer Name",
    "costAnalysis.client": "Client",
    "costAnalysis.prodDate": "Prod. Date",
    "costAnalysis.noLottos": "No production batches found for this year.",
    "costAnalysis.analysisTitle": "Batch Cost Analysis",
    "costAnalysis.backToSelection": "Back to Batch Selection",
    "costAnalysis.rawMaterialsCost": "Raw Materials Costs",
    "costAnalysis.ingredient": "Ingredient",
    "costAnalysis.quantityUsed": "Qty Used",
    "costAnalysis.unitPrice": "Unit Price",
    "costAnalysis.totalCost": "Total Cost",
    "costAnalysis.subtotal": "Subtotal",
    "costAnalysis.grandTotalRawMaterials": "Total Raw Materials Cost",
    "costAnalysis.priceNotFound": "Price not found",
    "costAnalysis.otherCosts": "Other Costs",
    "costAnalysis.totalGasCost": "Total Gas Cost",
    "costAnalysis.gasType": "Gas Type",
    "costAnalysis.additionalGases": "Additional Gases",
    "costAnalysis.exciseDuty": "Excise Duty",
    "costAnalysis.storage": "Storage",
    "costAnalysis.epal": "Epal",
    "costAnalysis.managementFees": "Brewery Management Fees",
    "costAnalysis.grandTotal": "GRAND TOTAL BATCH COSTS",
    "costAnalysis.effectivePricePerLiter": "EFFECTIVE PRICE PER LITER (BEER ONLY)",
    "costAnalysis.packagingCostAnalysis": "Kegging Cost Analysis",
    "costAnalysis.packagingFormat": "Format",
    "costAnalysis.beerCostPerLiter": "Beer Cost / Liter",
    "costAnalysis.containerCostPerLiter": "Container Cost / Liter",
    "costAnalysis.finalPricePerLiter": "Final Price / Liter",
    "costAnalysis.saveButton": "Save Analysis Changes",
    "costAnalysis.closeButton": "Close and Finalize Analysis",
    "costAnalysis.exportButton": "Generate Excel Sheet",
    "costAnalysis.analysisClosedMessage": "This analysis has been closed and can no longer be modified.",
    "costAnalysis.confirmCloseTitle": "Confirm Analysis Closure",
    "costAnalysis.confirmCloseMessage": "Are you sure you want to close and finalize this analysis? No further changes can be made. This action is irreversible.",
    "costAnalysis.cancel": "Cancel",
    "costAnalysis.confirm": "Yes, Close",
    "costAnalysis.useLabels": "Include label cost?",
    "costAnalysis.bottleCostAnalysis": "Bottling Cost Analysis",
    "costAnalysis.bottleFormat": "Bottle Format",
    "costAnalysis.bottleCount": "Bottle Count",
    "costAnalysis.beerCostPerBottle": "Beer Cost / btl",
    "costAnalysis.containerCostPerBottle": "Bottle Cost",
    "costAnalysis.capCostPerBottle": "Cap Cost",
    "costAnalysis.cartonCostPerBottle": "Carton Share",
    "costAnalysis.labelCostPerBottle": "Label Cost",
    "costAnalysis.finalPricePerBottle": "Final Price / btl",
    "costAnalysis.totalPriceForFormat": "Total Price for Format",
    "coefficients.modalTitle": "Price Calculation Coefficients",
    "coefficients.saveButton": "Save Coefficients",
    "coefficients.gplCost": "LPG Cost (€/m³)",
    "coefficients.gplCostTooltip": "Enter the price per cubic meter for LPG, as per your supply contract.",
    "coefficients.metanoCost": "Methane Cost (€/m³)",
    "coefficients.metanoCostTooltip": "Enter the price per cubic meter for Methane, as per your supply contract.",
    "coefficients.excise": "Excise Duty Coefficient",
    "coefficients.exciseTooltip": "Enter the coefficient for the beer excise duty, communicated annually by the Customs Agency.",
    "coefficients.storage": "Beer Storage Fee (€)",
    "coefficients.storageTooltip": "Enter a flat fee for storing the batch in company-owned cold storage.",
    "coefficients.epal": "Single Epal Cost (€)",
    "coefficients.epalTooltip": "Enter the purchase cost of a single EPAL pallet.",
    "coefficients.co2": "One-time CO2 Cost (€)",
    "coefficients.co2Tooltip": "Enter a flat fee for the use of CO2 for the batch.",
    "coefficients.azoto": "One-time Nitrogen Cost (€)",
    "coefficients.azotoTooltip": "Enter a flat fee for the use of Nitrogen for the batch.",
    "coefficients.management": "Management Fee (€/L)",
    "coefficients.managementTooltip": "Enter a coefficient (€/liter) to cover general brewery management expenses and include a profit margin.",
    "coefficients.steelKegWashing": "Steel Keg Washing Cost (€)",
    "coefficients.steelKegWashingTooltip": "Enter a flat fee for the washing and sanitizing of a reusable steel keg.",
    "coefficients.label": "Single Label Cost (€)",
    "coefficients.labelTooltip": "Enter the cost of a single self-adhesive label.",
    "productionTrend.title": "Client Production Trend",
    "productionTrend.selectClientPrompt": "Select a client to view the analysis",
    "productionTrend.totalLitersProduced": "Total Liters Produced",
    "productionTrend.productionHistory": "Production History",
    "productionTrend.packagedLiters": "Packaged Liters",
    "productionTrend.formatsUsed": "Formats Used",
    "productionTrend.productionTimeline": "Production Timeline",
    "productionTrend.liters": "Liters",
    "productionTrend.analysisByBeer": "Analysis by Beer Type",
    "productionTrend.totalBatches": "Total batches",
    "productionTrend.preferredFormat": "Preferred format",
    "productionTrend.analysisByFormat": "Analysis by Packaging Format",
    "productionTrend.volumeByBeerType": "Volume by Beer Type (%)",
    "productionTrend.volumeByFormat": "Volume by Format (Liters)",
    "brewQuote.title": "Quote for Beer to Produce",
    "brewQuote.exportButton": "Generate Quote (Excel)",
    "brewQuote.headerTitle": "Quote Information",
    "brewQuote.beerName": "Beer Name (Theoretical)",
    "brewQuote.estimatedLiters": "Estimated Final Liters",
    "brewQuote.estimatedGas": "Estimated Gas Usage (m³)",
    "brewQuote.ingredientsTitle": "Planned Ingredients",
    "brewQuote.addIngredient": "Add Ingredient",
    "brewQuote.selectIngredient": "Select Ingredient...",
    "brewQuote.packagingTitle": "Planned Packaging",
    "brewQuote.addPackaging": "Add Format",
    "brewQuote.quantity": "Quantity",
    "brewQuote.pieces": "Pieces",
    "brewQuote.saveButton": "Save Quote",
    "brewQuote.quoteListTitle": "Quote List",
    "brewQuote.newQuoteButton": "Create New Quote",
    "brewQuote.quoteName": "Quote Name",
    "brewQuote.date": "Date",
    "brewQuote.openButton": "Open",
    "brewQuote.noQuotes": "No saved quotes for this year.",
    "brewQuote.deleteConfirmTitle": "Confirm Quote Deletion",
    "brewQuote.deleteConfirmMessage": "Are you sure you want to delete this quote? This action is irreversible.",
    "toast.quoteSaved": "Quote saved successfully!",
    "toast.quoteDeleted": "Quote deleted.",
    "beerWarehouse.title": "Finished Beer Warehouse",
    "beerWarehouse.totalLiters": "Total Liters",
    "beerWarehouse.batch": "Batch",
    "beerWarehouse.format": "Format",
    "beerWarehouse.quantity": "Quantity (pcs)",
    "beerWarehouse.liters": "Liters",
    "beerWarehouse.noData": "No packaged beer found for this year.",
    "beerWarehouse.expirationDate": "Expiration",
    "salesTrend.topClientsByLiters": "Top Clients (by Liters)",
    "salesTrend.topBeersByLiters": "Top selling beers (by Liters)",
    "salesTrend.topFormatsByLiters": "Top selling formats (by Liters)",
    "salesTrend.litersPurchased": "Liters purchased",
    "salesTrend.litersSold": "Liters sold",
    "salesTrend.monthlySalesTrend": "Monthly Sales Trend"
};

type Locale = 'it' | 'en';
type Translations = typeof it;

interface LanguageContextType {
  locale: Locale;
  changeLanguage: (locale: Locale) => void;
  t: (key: keyof Translations, options?: Record<string, string | number>) => string;
}

const translations: Record<Locale, Translations> = { it, en };

const LanguageContext = createContext<LanguageContextType | undefined>(undefined);

export const LanguageProvider: React.FC<{ children: ReactNode }> = ({ children }) => {
  const [locale, setLocale] = useState<Locale>('it');

  useEffect(() => {
    const browserLang = navigator.language.split('-')[0];
    if (browserLang === 'en') {
      setLocale('en');
    }
  }, []);

  const changeLanguage = (newLocale: Locale) => {
    setLocale(newLocale);
  };

  const t = useCallback((key: keyof Translations, options?: Record<string, string | number>) => {
    let translation = translations[locale][key] || key;
    if (options) {
      Object.keys(options).forEach(optionKey => {
        translation = translation.replace(`{{${optionKey}}}`, String(options[optionKey]));
      });
    }
    return translation;
  }, [locale]);

  const value = { locale, changeLanguage, t };

  return (
    <LanguageContext.Provider value={value}>
      {children}
    </LanguageContext.Provider>
  );
};

export const useTranslation = () => {
  const context = useContext(LanguageContext);
  if (!context) {
    throw new Error('useTranslation must be used within a LanguageProvider');
  }
  return context;
};
